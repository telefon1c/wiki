---
order: -1
icon: git-pull-request-closed
---

# Выбор режима соединения
## Общая схема подключения
Предусмотрено несколько методов соединения MikoPBX (или сервера интеграции) и 1С. Разделение методов подключения обусловлено различными ограничениями клиентских приложений 1С и схемами организации сети. При настройке MikoPBX или сервера интеграции требуется выбрать между схемой с веб-сервисом или long-polling соединением. Ниже показана общая схема подключения.

<img class="miko-shadow"  
    src="/assets/root-guides/select-connection-mode/sposob_0.png"
    alt="МИКО: общая схема подключения"
/> 

Панель телефонии всегда подключается к MikoPBX (порт 4222). Сервер 1С подключается к MikoPBX для загрузки истории звонков (порт 8222). Далее в зависимости от схемы соединения может устанавливаться подключение от MikoPBX к веб-серверу 1С (порт по умолчанию 80) или наоборот от сервера 1С к MikoPBX (порт 8222).  
В настройках подсистемы 1С доступно два параметра:
- Канал передачи событий
- Канал передачи контактных данных  

Первый определяет, как события о поступающих звонках будут доставлены от АТС до клиента 1С. А второй - как внешняя панель получит из 1С информацию о контактах.  
Ниже предложено несколько примеров организации сети, чтобы помочь разобраться в правильном выборе настроек.

## Пример 1. Работа в локальная сети, тонкий клиент 1С

<img class="miko-shadow"  
    src="/assets/root-guides/select-connection-mode/sposob_1.png"
    alt="МИКО: схема подключения, локальная сеть, тонкий клиент"
/> 

**Организация сети:** сервер 1С и АТС расположены в одной сети.  
**Режим работы 1С:** тонкий клиент.
Самая простая схема. Все оборудование находится в одной сети. Тонкий клиент 1С подключается к MikoPBX через внешнюю компоненту. MikoPBX подключается к веб-сервису 1С опубликованному на веб-сервере Apache или IIS.  

**Настройки в MikoPBX:**  
Способ соединения с 1С: веб-сервис.  
Адрес и порт: 172.16.32.1:80.  

**Настройки в 1С:**  
Адрес и порт: 172.16.32.2:8222.  
Канал передачи событий: внешняя компонента.  
Канал передачи контактных данных: веб-сервис.

**Дополнительно:**  
Установить Apache или IIS и опубликовать веб-сервис 1С.  
!!!
Если работа с внешней панелью телефонии не предполагается, то можно не публиковать веб-сервис.
!!!

## Пример 2. MikoPBX в облаке, тонкий клиент 1С

<img class="miko-shadow"  
    src="/assets/root-guides/select-connection-mode/sposob_2.png"
    alt="МИКО: схема подключения, АТС в облаке, тонкий клиент 1С"
/> 

**Организация сети:** сервер 1С расположен в локальной сети, АТС - в облаке.  
**Режим работы 1С:** тонкий клиент.  

Поскольку АТС расположена за пределами локальной сети, то у нее нет прямого сообщения с сервером 1С. Можно получить выделенный IP-адрес и опубликовать базу в интернете или использовать схему с long-polling соединением. В этом случае сервер 1С установит постоянное подключение к MikoPBX.  

**Настройки в MikoPBX:**  
Способ соединения с 1С: long-polling соединение.  

**Настройки в 1С:**  
Адрес и порт: 94.100.180.202:8222.  
Канал передачи событий: внешняя компонента.  
Канал передачи контактных данных: long-polling соединение.  

## Пример 3. 1С в облаке, веб-клиент 1С

<img class="miko-shadow"  
    src="/assets/root-guides/select-connection-mode/sposob_3.png"
    alt="МИКО: схема подключения, 1С в облаке, веб-клиент 1С"
/> 

**Организация сети:** сервер 1С расположен в облаке, АТС - в облаке.  
**Режим работы 1С:** веб-клиент.  

Сервер 1С расположен в облаке. Поэтому для работы журнала звонков АТС также потребуется разместить в облаке или на компьютере с выделенным IP адресом. Веб-клиент 1С не имеет прямого сообщения с MikoPBX. События о звонках сначала поступают на сервер 1С и далее в веб-клиент через систему взаимодействия. Потребуется опубликовать веб-сервис и зарегистрировать базу в системе взаимодействия 1С.  

**Настройки в MikoPBX:**  
Способ соединения с 1С: веб-сервис.  
Адрес и порт: 185.98.85.241:80.  

**Настройки в 1С:**  
Адрес и порт: 94.100.180.202:8222.  
Канал передачи событий: веб-сервис.  
Канал передачи контактных данных: веб-сервис.  

**Дополнительно:**  
Установить Apache или IIS (в облаке это обычно уже выполнено) и опубликовать веб-сервис 1С.  
Зарегистрировать базу в сервисе 1С:Диалог для получения доступа к системе взаимодействия.  

// Заготовка таблицы

| ---- | Внешняя компонента       | Веб-сервис | Long-poll соединение  |
|---------|--------------------------|----------------------|-----------------------|
| Вид клиента 1С | Тонкий клиент            | Тонкий и веб клиенты | Тонкий и веб клиенты |
| Операционная система | Windows | Windows, Linux, macOS | Windows, Linux, macOS |
| Поддерживаемые ОС | Windows 7/8/10/2012/2016 | тоже                 | тоже                  |
| Работа на сервере терминалов (RDP) | Да                       | Да                   | Да                    |
| Уведомление о входящем вызове | Да                       | Да                   | Да                    |
| Идентификация клиента по номеру телефона ((Возможность определения названия клиента по номеру телефона появляется после выполнения интеграции с 1С.)) | Да                       | Да                   | Да                    |
| Ответ на звонок по кнопке | Да [^1]                  | Да [^1]              | Да [^2]               |
| Совершение исходящих вызовов | Да                       | Да                   | Да                    |
| Перевод вызова на сотрудника | Да                       | Да                   | Да                    |
| История последних вызовов | Да                       | Да                   | Да                    |
| Запись разговоров | Да                       | Да                   | Да [^3]               |
| Чаты с клиентами (WhatsApp) | Да                       | Да                   | Да                    |
| Отображение собеседников сотрудников (супервизор) | Да                       | Да                   | ---                   |
| Подсушивание разговора, суфлирование (супервизор) | Да                       | Да                   | ---                   |
| Конференц-вызовы | Да                       | Да                   | ---                   |
| Перехват вызова (в ручную) | Да                       | Да                   | Да                    |
| Перехват вызова (автоматически) на ответственного сотрудника | Да                       | Да                   | ---                   |
| Статусы телефонов (в сети, занят, не в сети) | Да                       | Да                   | ---                   |
| Статусы присутствия (на месте, отошел) | Да                       | Да                   | Да                    |